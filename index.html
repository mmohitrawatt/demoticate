<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MORAXE</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link
        href="https://fonts.googleapis.com/css2?family=Creepster&family=Orbitron:wght@500;900&family=Share+Tech+Mono&family=Special+Elite&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --horror-red: #ff0000;
            --cyber-green: #00ff00;
            --dark-glass: rgba(0, 0, 0, 0.85);
            --neon-glow: 0 0 15px var(--horror-red);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            cursor: crosshair;
        }

        body {
            background-color: #000;
            color: var(--cyber-green);
            font-family: 'Share Tech Mono', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- CRT & NOISE EFFECTS --- */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 1000;
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }

        @keyframes scan {
            from {
                top: -100px;
            }

            to {
                top: 100%;
            }
        }

        .scan-anim {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: rgba(0, 255, 0, 0.05);
            animation: scan 5s linear infinite;
            z-index: 1001;
            pointer-events: none;
        }

        /* --- MAIN UI CONTAINERS --- */
        #start-screen,
        #end-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            transition: opacity 1.5s ease;
        }

        #end-screen {
            display: none;
            overflow-y: auto;
            justify-content: flex-start;
            padding-top: 60px;
        }

        /* --- TYPOGRAPHY --- */
        h1 {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 4px;
        }

        .glitch-text {
            text-shadow: 2px 0 #f00, -2px 0 #0f0;
        }

        /* --- PREMIUM BUTTON --- */
        .challenge-btn {
            background: var(--dark-glass);
            color: #fff;
            border: 1px solid var(--horror-red);
            padding: 20px 60px;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            letter-spacing: 5px;
            text-transform: uppercase;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1010;
            margin-top: 30px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 450px;
            cursor: pointer;
        }

        .challenge-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px var(--horror-red);
            background: var(--horror-red);
            color: #000;
        }

        /* --- WEBCAM & GALLERY --- */
        #cam-frame {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 180px;
            height: 250px;
            border: 2px solid var(--cyber-green);
            z-index: 40;
            opacity: 0;
            transition: opacity 1s;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
        }

        #webcam {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(100%) contrast(150%);
            transform: scaleX(-1);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
        }

        .gallery-item {
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s, border-color 0.3s;
            filter: brightness(0.8) sepia(0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .gallery-item:hover {
            transform: scale(1.05);
            z-index: 10;
            border-color: #f00;
            filter: brightness(1) sepia(0);
        }

        /* --- ANIMATIONS --- */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes flicker {

            0%,
            19.999%,
            22%,
            62.999%,
            64%,
            64.999%,
            70%,
            100% {
                opacity: 1;
            }

            20%,
            21.999%,
            63%,
            63.999%,
            65%,
            69.999% {
                opacity: 0.4;
            }
        }

        .violent-shake {
            animation: shake 0.1s infinite;
        }

        @keyframes shake {
            0% {
                transform: translate(2px, 2px);
            }

            50% {
                transform: translate(-2px, -2px);
            }

            100% {
                transform: translate(2px, -2px);
            }
        }

        #text-area {
            padding: 40px;
            text-align: center;
        }

        .highlight {
            font-size: 80px;
            color: var(--horror-red);
            font-family: 'Creepster';
            text-shadow: var(--neon-glow);
            margin: 30px 0;
        }

        .text-word {
            font-size: 40px;
            margin: 0 10px;
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        #container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }

        #snapshot-canvas {
            display: none;
        }

        .flash-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            opacity: 0;
            z-index: 100;
            pointer-events: none;
            transition: opacity 0.1s;
        }

        #ghost-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            opacity: 0;
            pointer-events: none;
            z-index: 45;
        }

        #lockdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #f00;
            color: #000;
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: 'Orbitron';
            padding: 30px;
        }

        .fake-popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #f00;
            color: #fff;
            padding: 10px 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            z-index: 500;
            border: 2px solid #fff;
            box-shadow: 0 0 20px #f00;
            display: none;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 24px;
            }

            .highlight {
                font-size: 45px;
            }

            .text-word {
                font-size: 25px;
            }

            .challenge-btn {
                font-size: 18px;
                padding: 15px 30px;
                margin-top: 20px;
            }

            #cam-frame {
                width: 120px;
                height: 180px;
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>

<body>
    <!-- SVG FX -->
    <svg style="display: none;">
        <defs>
            <filter id="melt-filter">
                <feTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="2" result="warp" />
                <feDisplacementMap xChannelSelector="R" yChannelSelector="G" scale="0" in="SourceGraphic" in2="warp" />
            </filter>
        </defs>
    </svg>

    <div id="lockdown-overlay">
        <h2 style="font-size: 32px; margin-bottom: 20px; font-weight: 900;">CHALLENGE_BREACHED</h2>
        <p style="font-size: 18px; line-height: 1.5; font-weight: bold;">Kahan bhag raha hai? Connection toda toh system
            permanent delete ho jayega.<br>Reality abhi baki hai.</p>
        <button class="challenge-btn" style="margin-top:30px; border-color:#fff; color:#fff;"
            onclick="dismissLockdown()">RESTORE NEURAL LINK</button>
    </div>

    <div id="fake-popup" class="fake-popup">WARNING: NEURAL LINK BREACHED</div>

    <div class="scanlines"></div>
    <div class="scan-anim"></div>
    <div class="flash-layer" id="flash"></div>

    <div id="cam-frame">
        <video id="webcam" autoplay playsinline muted></video>
        <div id="ghost-overlay"></div>
    </div>

    <div id="start-screen">
        <h1 class="glitch-text" style="font-size: clamp(32px, 8vw, 60px); color: var(--cyber-green);">
            MORAXE_TRUTH_CHALLENGE</h1>

        <div
            style="margin: 40px 0; border: 1px solid var(--cyber-green); padding: 30px; background: rgba(0,255,0,0.05); max-width: 600px; text-align: left;">
            <p style="color: var(--cyber-green); font-size: 20px; line-height: 1.6;">
                Kya aap bina palkein jhapkaye 60 seconds tak apni asliyat dekh sakte ho?
            </p>
            <div style="margin-top: 25px; border-top: 1px solid rgba(0,255,0,0.2); padding-top: 20px;">
                <p style="opacity: 0.6; font-size: 12px; letter-spacing: 2px;">PROTOCOL:</p>
                <p style="font-size: 14px; margin: 5px 0;">1. DO NOT FLINCH / NO EYE BLINK</p>
                <p style="font-size: 14px; margin: 5px 0;">2. MUST ENABLE CAMERA FEED</p>
                <p style="font-size: 14px; margin: 5px 0;">3. SYSTEM WILL ARCHIVE YOUR SINS</p>
            </div>
        </div>

        <button class="challenge-btn" id="start-btn">ACCEPT CHALLENGE</button>
        <div style="margin-top: 20px; opacity: 0.3; font-size: 12px; letter-spacing: 5px;">WWW.MORAXE.IN</div>
    </div>

    <div id="end-screen">
        <h1 class="glitch-text" style="color:#f00; font-size:45px; text-shadow: var(--neon-glow);">WALL_OF_SHAME</h1>

        <div
            style="background: rgba(255,0,0,0.2); border: 2px solid #f00; padding: 30px; margin: 30px 0; max-width: 750px; width: 95%; box-shadow: 0 0 50px rgba(255,0,0,0.2); text-align: left;">
            <p
                style="color:#f00; font-weight: 900; margin-bottom: 20px; font-size: 22px; font-family: 'Orbitron'; letter-spacing: 2px;">
                FINAL_COMMANDS:</p>

            <p
                style="color:#fff; font-size: 20px; font-family: 'Share Tech Mono'; margin-bottom: 15px; line-height: 1.5;">
                1. Apni gallery me ye 6 gunah (sins) dekho. Ye tumhara asli chehra hai.
            </p>
            <p
                style="color:#fff; font-size: 20px; font-family: 'Share Tech Mono'; margin-bottom: 15px; line-height: 1.5;">
                2. Inhe social media par upload karo aur <span
                    style="color:var(--cyber-green); font-weight: bold;">@MORAXE.IN</span> ko tag karo.
            </p>
            <p
                style="color:#fff; font-size: 20px; font-family: 'Share Tech Mono'; margin-bottom: 30px; line-height: 1.5;">
                3. Aaj se social media se gayab ho jao. **PERMANENT LOGOUT.** Reality se bhago mat.
            </p>

            <div style="border-top: 1px solid #f00; padding-top: 20px; text-align: center;">
                <p
                    style="color:#f00; font-size: 24px; font-family: 'Orbitron'; line-height: 1.2; font-weight: 900; animation: flicker 0.1s infinite;">
                    LOGOUT IMMEDIATELY. REALITY IS WAITING.
                </p>
            </div>
        </div>

        <div id="share-container"
            style="display: none; margin-bottom: 30px; width: 100%; max-width: 450px; text-align: center;">
            <button class="challenge-btn" onclick="shareAllPhotos()"
                style="background: #f00; border-color: #fff; width: 100%; animation: pulse 1s infinite;">
                SAVE 6 SINS TO PHOTOS
            </button>
        </div>

        <div class="gallery-grid" id="gallery-grid"></div>

        <div style="margin-top: 100px; padding-bottom: 50px; width: 100%; max-width: 500px; text-align: center;">
            <p style="color:var(--cyber-green); font-size: 16px; opacity: 0.8;">
                CURATED BY <a href="https://instagram.com/mohitrawat.me" target="_blank"
                    style="color: #fff; text-decoration: none; border-bottom: 1px dashed var(--cyber-green); font-weight: bold;">MOHITRAWAT.ME</a>
            </p>
            <p style="color:var(--cyber-green); font-size: 10px; margin-top: 15px; opacity: 0.4; letter-spacing: 5px;">
                MORAXE.IN | ARCHIVING THE FALLEN</p>
        </div>
    </div>

    <div id="container">
        <div id="text-area"></div>
    </div>

    <script>
        const startBtn = document.getElementById('start-btn');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const textArea = document.getElementById('text-area');
        const galleryGrid = document.getElementById('gallery-grid');
        const webcam = document.getElementById('webcam');
        const camFrame = document.getElementById('cam-frame');
        const ghostOverlay = document.getElementById('ghost-overlay');
        const fakePopup = document.getElementById('fake-popup');
        const meltFilter = document.querySelector("#melt-filter feDisplacementMap");
        const canvas = document.getElementById('snapshot-canvas');
        const flash = document.getElementById('flash');
        const lockdownOverlay = document.getElementById('lockdown-overlay');

        let audioCtx;
        let heartbeatOsc;
        let heartbeatTempo = 60; // Start with 60 BPM
        const alienChars = "░▒▓█<>/X¥∆∑Ω";
        const capturedPhotos = [];
        const capturedBlobs = [];
        const shareContainer = document.getElementById('share-container');

        // AGGRESSIVE LOCKDOWN
        window.addEventListener('blur', () => triggerLockdown());
        document.addEventListener('visibilitychange', () => { if (document.hidden) triggerLockdown(); });
        document.body.addEventListener('touchstart', forceFullScreen);
        document.body.addEventListener('click', forceFullScreen);

        function forceFullScreen() {
            try {
                const docEl = document.documentElement;
                if (docEl.requestFullscreen) docEl.requestFullscreen().catch(() => { });
                else if (docEl.webkitRequestFullscreen) docEl.webkitRequestFullscreen().catch(() => { });
                else if (docEl.mozRequestFullScreen) docEl.mozRequestFullScreen().catch(() => { });
                else if (docEl.msRequestFullscreen) docEl.msRequestFullscreen().catch(() => { });
            } catch (e) { console.warn("Fullscreen failed", e); }
        }
        function triggerLockdown() {
            if (startScreen.style.display === 'none' && endScreen.style.display === 'none') {
                lockdownOverlay.style.display = 'flex';
                if (navigator.vibrate) navigator.vibrate([300, 100, 300]);
            }
        }
        function dismissLockdown() { lockdownOverlay.style.display = 'none'; forceFullScreen(); }
        window.onbeforeunload = () => "Challenge in progress. Reality is watching.";

        startBtn.addEventListener('click', () => {
            // Unlock Voice Narration
            speakHorror(" ");

            // CHECK FOR SECURE CONTEXT (HTTPS)
            if (!window.isSecureContext && location.hostname !== "localhost" && location.hostname !== "127.0.0.1") {
                alert("CRITICAL: Camera required. Browser blocks camera on HTTP.\n\nPlease use HTTPS or test on localhost.");
            }

            // Start experience immediately to be responsive on mobile
            startExperience();

            // Camera request in background - DEFENSIVE CHECK
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.error("Camera API missing");
                alert("ERROR: Browser does not support camera or access is blocked (Secure context required).");
                return;
            }

            const constraints = { video: { facingMode: 'user' }, audio: false };
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    webcam.srcObject = stream;
                    webcam.play().catch(e => console.error(e));
                    camFrame.style.opacity = 1;
                })
                .catch(err => {
                    console.error("Camera Error:", err);
                    let errMsg = "CHALLENGE REQUIRES VISUAL FEED.";
                    if (err.name === 'NotAllowedError') errMsg = "CAMERA PERMISSION DENIED.";

                    const ua = navigator.userAgent || navigator.vendor || window.opera;
                    if (/Instagram|FBAN|FBAV|WhatsApp/i.test(ua)) {
                        errMsg += "\n\nTIP: Open in Chrome/Safari (In-app browsers block camera).";
                    }
                    alert(errMsg);
                });
        });

        function startExperience() {
            forceFullScreen();
            initPsychAudio();
            startScreen.style.opacity = 0;
            setTimeout(() => {
                startScreen.style.display = 'none';
                startCountdown();
                setTimeout(() => triggerViralSequencer(), 3000);
                setTimeout(() => triggerRandomEffects(), 5000);
            }, 1000);
        }

        // === PSYCHOLOGICAL AUDIO ENGINE ===
        function initPsychAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();

            // 1. DRONE
            const drone = audioCtx.createOscillator();
            drone.type = 'sawtooth'; drone.frequency.value = 35;
            const droneGain = audioCtx.createGain(); droneGain.gain.value = 0.05;
            drone.connect(droneGain); droneGain.connect(audioCtx.destination);
            drone.start();

            // 2. WHISPERS (Binaural)
            setInterval(() => {
                const whisper = audioCtx.createOscillator();
                const whisperGain = audioCtx.createGain();
                const panner = audioCtx.createStereoPanner();
                whisper.type = 'sine'; whisper.frequency.value = 400 + Math.random() * 2000;
                panner.pan.setValueAtTime((Math.random() * 2) - 1, audioCtx.currentTime);
                whisperGain.gain.setValueAtTime(0, audioCtx.currentTime);
                whisperGain.gain.linearRampToValueAtTime(0.02, audioCtx.currentTime + 0.1);
                whisperGain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
                whisper.connect(panner); panner.connect(whisperGain); whisperGain.connect(audioCtx.destination);
                whisper.start(); whisper.stop(audioCtx.currentTime + 0.5);
            }, 1500);

            // 3. HEARTBEAT
            pulseHeart();
        }

        function pulseHeart() {
            const beat = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            beat.type = 'sine'; beat.frequency.setValueAtTime(60, audioCtx.currentTime);
            beat.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
            beat.connect(gain); gain.connect(audioCtx.destination);
            beat.start(); beat.stop(audioCtx.currentTime + 0.2);

            setTimeout(pulseHeart, (60 / heartbeatTempo) * 1000);
        }

        function triggerGlitchSound() {
            if (!audioCtx) return;
            const noise = audioCtx.createBufferSource();
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.1, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < buffer.length; i++) data[i] = Math.random() * 2 - 1;
            noise.buffer = buffer;
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
            noise.connect(gain); gain.connect(audioCtx.destination);
            noise.start();
        }

        // === RANDOM HORROR EFFECTS ===
        function triggerRandomEffects() {
            setInterval(() => {
                if (Math.random() > 0.7) {
                    ghostOverlay.style.opacity = 0.3;
                    setTimeout(() => ghostOverlay.style.opacity = 0, 1000 + Math.random() * 2000);
                }
                if (Math.random() > 0.8) {
                    const messages = ["WARNING: NEURAL DATA LEAKED", "UPLOADING SUBJECT ARCHIVE...", "SYTEM OVERHEAT: 88%", "BIOMETRIC MATCH FOUND"];
                    fakePopup.innerText = messages[Math.floor(Math.random() * messages.length)];
                    fakePopup.style.display = 'block';
                    setTimeout(() => fakePopup.style.display = 'none', 2000);
                }
            }, 5000);
        }

        // === VIRAL 6-PHOTO SEQUENCER ===
        async function triggerViralSequencer() {
            const types = ['scanner', 'loser', 'mala', 'death', 'possession', 'chosen'];
            for (let i = 0; i < 6; i++) {
                takePremiumSnapshot(types[i]);
                await wait(8000 + Math.random() * 3000);
            }
        }

        function takePremiumSnapshot(type) {
            triggerGlitchSound();
            const ctx = canvas.getContext('2d');
            canvas.width = 720; canvas.height = 1080;
            ctx.translate(canvas.width, 0); ctx.scale(-1, 1);
            if (type === 'possession') ctx.filter = 'invert(100%) grayscale(100%) contrast(200%)';
            else if (type === 'chosen') ctx.filter = 'contrast(120%) brightness(1.1) sepia(0.3) saturate(2)';
            else ctx.filter = 'grayscale(100%) contrast(150%) brightness(0.9) sepia(0.2)';
            ctx.drawImage(webcam, 0, 0, canvas.width, canvas.height);
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.filter = 'none';

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            if (type === 'scanner') {
                ctx.strokeStyle = '#0f0'; ctx.lineWidth = 1;
                for (let i = 0; i < canvas.height; i += 40) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(canvas.width, i); ctx.stroke(); }
                ctx.fillStyle = '#0f0'; ctx.font = 'bold 30px "Share Tech Mono"'; ctx.fillText(`SUBJECT_SCAN: ${Date.now()}`, 40, 60);
            } else if (type === 'loser') {
                ctx.save(); ctx.translate(centerX, centerY); ctx.rotate(-20 * Math.PI / 180);
                ctx.strokeStyle = '#f00'; ctx.lineWidth = 15; ctx.strokeRect(-250, -70, 500, 140);
                ctx.fillStyle = '#f00'; ctx.font = 'bold 80px "Special Elite"'; ctx.textAlign = 'center';
                ctx.fillText('VERIFIED LOSER', 0, 25); ctx.restore();
            } else if (type === 'mala') {
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 10; ctx.beginPath(); ctx.ellipse(centerX, 850, 280, 350, 0, 0, Math.PI * 2); ctx.stroke();
                for (let a = 0; a < Math.PI * 2; a += 0.3) {
                    ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(centerX + Math.cos(a) * 285, 850 + Math.sin(a) * 355, 25, 0, Math.PI * 2); ctx.fill();
                    ctx.fillStyle = '#f00'; ctx.beginPath(); ctx.arc(centerX + Math.cos(a) * 285, 850 + Math.sin(a) * 355, 8, 0, Math.PI * 2); ctx.fill();
                }
                ctx.fillStyle = '#fff'; ctx.font = 'bold 50px serif'; ctx.textAlign = 'center'; ctx.fillText('RIP', centerX, 1020);
            } else if (type === 'death') {
                ctx.fillStyle = 'rgba(0,0,0,0.8)'; ctx.fillRect(0, 850, canvas.width, 230);
                ctx.fillStyle = '#f00'; ctx.font = 'bold 40px "Orbitron"'; ctx.textAlign = 'center';
                ctx.fillText('EXPECTED EXPIRY:', centerX, 920);
                ctx.font = 'bold 70px "Orbitron"'; ctx.fillText("30 OCT 2075", centerX, 1010);
            } else if (type === 'possession') {
                ctx.fillStyle = '#f00'; ctx.font = 'bold 90px "Creepster"'; ctx.textAlign = 'center'; ctx.fillText('INSPECTED', centerX, 150);
            } else if (type === 'chosen') {
                ctx.shadowBlur = 30; ctx.shadowColor = '#0f0';
                ctx.fillStyle = '#cf0'; ctx.font = '80px "Orbitron"'; ctx.textAlign = 'center'; ctx.fillText('CHOSEN_ONE', centerX, 150);
            }

            // BRANDING
            ctx.shadowBlur = 0; ctx.fillStyle = '#000'; ctx.fillRect(0, canvas.height - 60, canvas.width, 60);
            ctx.fillStyle = '#fff'; ctx.font = 'bold 24px "Orbitron"'; ctx.textAlign = 'left'; ctx.fillText('MORAXE.IN', 30, canvas.height - 22);
            ctx.textAlign = 'right'; ctx.fillText(`ID_${Date.now().toString().slice(-6)}`, canvas.width - 30, canvas.height - 22);

            flash.style.opacity = 0.8; setTimeout(() => flash.style.opacity = 0, 200);
            const dataUrl = canvas.toDataURL('image/png');
            capturedPhotos.push(dataUrl);

            // Store as File/Blob for Sharing
            canvas.toBlob(blob => {
                const file = new File([blob], `SIN_${type.toUpperCase()}_${Date.now()}.png`, { type: 'image/png' });
                capturedBlobs.push(file);
            }, 'image/png');

            const link = document.createElement('a'); link.href = dataUrl;
            link.download = `TRUTH_CHALLENGE_${type.toUpperCase()}.png`;
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }

        const script = [
            { t: "Kahan bhag rahe ho sach se?", d: 4500, tempo: 60 },
            { t: "Aaj raat nind nahi aayegi. Ye chehra yaad rahega.", d: 4000, tempo: 70 },
            { t: "Maa-baap ko lagta hai tu unka sahara banega.", d: 4500, tempo: 80 },
            { big: "PUSTAINI FAILURE", d: 5500, shake: true, tempo: 100 },
            { t: "Par tu bas unki ummedon ka qatil hai.", d: 4500 },
            { t: "Wo teri safalta ka intezar kar rahe hain.", d: 3500 },
            { t: "Aur tu unhe bas ek lachar budhapa de raha hai.", d: 4000 },
            { big: "GATAR KI ZINDAGI", d: 5500, shake: true, tempo: 120 },
            { t: "Tere doston ki naukri lag gayi. Wo aage nikal gaye.", d: 5000 },
            { t: "Tu unki photos like karega. Aur room me andhera.", d: 4500 },
            { t: "Duniya tujhe bhool jayegi. Jaise tu tha hi nahi.", d: 3500 },
            { t: "Bas ek bojh. Bas ek galti.", d: 5000 },
            { big: "SAMAJH LE TU KHATAM HAI", d: 5500, shake: true, tempo: 140 },
            { t: "Agle 5 saal baad bhi tu yahin hoga. Khali hath.", d: 4500 },
            { t: "Sab khatam ho raha hai. Aur tu bas dekh raha hai.", d: 4000 },
            { t: "Teri kismat me sirf rejection hai.", d: 4500 },
            { big: "BINA KAAM KA KACHRA", d: 6000, shake: true, tempo: 160 },
            { t: "Dar lag raha hai na future se?", d: 4500 },
            { big: "THE END IS HERE", d: 3500, tempo: 180 },
            { t: "Check your sins. Subject.", d: 5000 },
        ];

        let availableVoices = [];
        function loadVoices() {
            availableVoices = window.speechSynthesis.getVoices();
        }
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }

        function speakHorror(text) {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();

            const msg = new SpeechSynthesisUtterance(text);
            if (availableVoices.length === 0) loadVoices();

            // Prioritize Hindi voices for Hinglish text to prevent spelling out words
            const preferredVoice = availableVoices.find(v => v.lang.includes('hi-IN'))
                || availableVoices.find(v => v.lang.includes('en') && (v.name.includes('David') || v.name.includes('Standard-B') || v.name.includes('Natural')))
                || availableVoices.find(v => v.name.includes('Male'))
                || availableVoices[0];

            msg.voice = preferredVoice;
            msg.pitch = 0.8; // Deep but clear enough to avoid "spelling mode"
            msg.rate = 0.8;  // Deliberate pacing
            msg.volume = 1;

            // Set lang to hi-IN if a Hindi voice is found, else en-US
            msg.lang = preferredVoice.lang.includes('hi-IN') ? 'hi-IN' : 'en-US';

            setTimeout(() => {
                if (window.speechSynthesis) window.speechSynthesis.speak(msg);
            }, 60);
        }

        async function startCountdown() {
            let timeLeft = 60;
            const timerInt = setInterval(() => {
                timeLeft--;
                const progress = (60 - timeLeft) / 60;
                meltFilter.setAttribute("scale", progress * 100);
                if (timeLeft <= 0) clearInterval(timerInt);
            }, 1000);

            for (let item of script) {
                if (item.tempo) heartbeatTempo = item.tempo;
                textArea.innerHTML = "";
                const currentText = item.big || item.t;
                speakHorror(currentText);

                if (item.big) {
                    triggerGlitchSound();
                    // Intense Ghost Burst during big psychological attacks
                    ghostOverlay.style.opacity = 0.5;
                    setTimeout(() => ghostOverlay.style.opacity = 0, 800);

                    const div = document.createElement("div"); div.className = `highlight ${item.shake ? 'violent-shake' : ''}`;
                    textArea.appendChild(div); showDecodedText(div, item.big, 30);
                } else {
                    let words = item.t.split(" ");
                    for (let w of words) {
                        const span = document.createElement("span"); span.className = "text-word";
                        textArea.appendChild(span); showDecodedText(span, w, 40); await wait(400);
                    }
                }
                await wait(item.d);
            }
            showWallOfShame();
        }

        function showWallOfShame() {
            if (audioCtx) {
                speakHorror("The challenge is over. But your life is still the same. Check your gallery, if you can bear to look.");
            }
            endScreen.style.display = 'flex';
            galleryGrid.innerHTML = ""; // Clear existing
            capturedPhotos.forEach(p => {
                const img = document.createElement('img');
                img.className = 'gallery-item';
                img.src = p;
                galleryGrid.appendChild(img);
            });

            // Show share button if we have images
            if (capturedPhotos.length > 0) {
                shareContainer.style.display = 'block';
            }
        }

        async function shareAllPhotos() {
            if (navigator.share && capturedBlobs.length > 0) {
                try {
                    await navigator.share({
                        files: capturedBlobs,
                        title: 'MORAXE: 6 SINS',
                        text: 'Duniya ko apna asli chehra dikhao. @moraxe.in'
                    });
                } catch (err) {
                    console.error("Share failed:", err);
                    alert("Sharing failed. Please save images manually by long-pressing them.");
                }
            } else if (!navigator.share) {
                alert("Please save images manually by long-pressing them (Your browser doesn't support easy share).");
            } else {
                alert("No images captured yet.");
            }
        }

        function showDecodedText(el, text, speed) {
            let i = 0;
            const inv = setInterval(() => {
                el.innerText = text.split("").map((l, idx) => idx < i ? l : alienChars[Math.floor(Math.random() * alienChars.length)]).join("");
                if (i >= text.length) clearInterval(inv);
                i += 0.5;
            }, speed);
        }
        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
    </script>
</body>

</html>